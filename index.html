<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buku Kas Bulanan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes bookOpen {
      0% { transform: perspective(1200px) rotateY(0deg); }
      100% { transform: perspective(1200px) rotateY(-180deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .book-opening {
      animation: bookOpen 0.8s ease forwards;
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    .progress-bar {
      transition: width 0.5s ease, background-color 0.3s ease;
    }
    
    .input-field {
      transition: all 0.3s ease;
    }
    
    .input-field:focus {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full min-h-full m-0 p-0">
  <main id="app" class="w-full min-h-full flex items-center justify-center p-8"></main>
  <script>
    const config = {
      background_color: "#0f172a",
      surface_color: "#ffffff",
      text_color: "#1e293b",
      primary_action_color: "#2563eb",
      secondary_action_color: "#64748b",
      font_family: "Inter",
      font_size: 16,
      app_title: "Buku Kas Bulanan",
      new_budget_text: "Budget Baru",
      view_budgets_text: "Lihat Budget",
      add_income_text: "Tambah Pemasukan",
      add_expense_text: "Tambah Pengeluaran",
      save_text: "Simpan",
      back_text: "Kembali"
    };

    let allRecords = [];
    let currentPage = 'home';
    let currentBudget = null;

    // Load data dari localStorage saat pertama kali
    function loadData() {
      const stored = localStorage.getItem('bukuKasData');
      if (stored) {
        try {
          allRecords = JSON.parse(stored);
        } catch (e) {
          allRecords = [];
        }
      }
    }

    // Simpan data ke localStorage
    function saveData() {
      localStorage.setItem('bukuKasData', JSON.stringify(allRecords));
    }

    // Create new record
    function createRecord(record) {
      allRecords.push(record);
      saveData();
      return true;
    }

    function getBudgets() {
      return allRecords.filter(r => r.type === 'budget').sort((a, b) => {
        if (a.tahun !== b.tahun) return b.tahun - a.tahun;
        return b.bulan - a.bulan;
      });
    }

    function getExpenses(budgetId) {
      return allRecords
        .filter(r => r.type === 'expense' && r.budget_id === budgetId)
        .sort((a, b) => a.tanggal - b.tanggal);
    }

    function getIncomes(budgetId) {
      return allRecords
        .filter(r => r.type === 'income' && r.budget_id === budgetId)
        .sort((a, b) => a.tanggal - b.tanggal);
    }

    function renderHome() {
      currentPage = 'home';
      const app = document.getElementById('app');
      
      app.style.background = `linear-gradient(135deg, ${config.background_color} 0%, ${adjustColor(config.background_color, 30)} 100%)`;
      
      app.innerHTML = `
        <div class="fade-in" style="width: 400px; height: 500px; background: linear-gradient(135deg, ${config.primary_action_color} 0%, ${adjustColor(config.primary_action_color, -20)} 100%); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 3px solid ${adjustColor(config.primary_action_color, -30)}; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);">
          <div style="position: absolute; top: 30px; left: 30px; right: 30px; bottom: 30px; border: 2px solid ${config.surface_color}; opacity: 0.3; border-radius: 8px;"></div>
          
          <h1 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 2}px; font-weight: 700; color: ${config.surface_color}; text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); z-index: 1; padding: 0 20px;">
            ${config.app_title}
          </h1>
          
          <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.surface_color}; opacity: 0.9; text-align: center; margin-bottom: 50px; z-index: 1; padding: 0 40px;">
            üìù Buat budget ‚Üí ‚ûï Catat pengeluaran ‚Üí üìä Lihat laporan
          </p>
          
          <div style="display: flex; flex-direction: column; gap: 20px; z-index: 1;">
            <button id="newBudgetBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px 40px; background-color: ${config.surface_color}; color: ${config.primary_action_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: all 0.3s ease;">
              ${config.new_budget_text}
            </button>
            
            <button id="viewBudgetsBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px 40px; background-color: ${config.surface_color}; color: ${config.primary_action_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: all 0.3s ease;">
              ${config.view_budgets_text}
            </button>
          </div>
        </div>
      `;
      
      const newBudgetBtn = document.getElementById('newBudgetBtn');
      const viewBudgetsBtn = document.getElementById('viewBudgetsBtn');
      
      [newBudgetBtn, viewBudgetsBtn].forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
          this.style.boxShadow = '0 6px 16px rgba(0,0,0,0.3)';
        });
        
        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
        });
      });
      
      newBudgetBtn.addEventListener('click', () => {
        document.querySelector('.fade-in').classList.add('book-opening');
        setTimeout(() => renderNewBudget(), 800);
      });
      
      viewBudgetsBtn.addEventListener('click', () => {
        document.querySelector('.fade-in').classList.add('book-opening');
        setTimeout(() => renderBudgetList(), 800);
      });
    }

    function renderNewBudget() {
      currentPage = 'new-budget';
      const app = document.getElementById('app');
      
      app.innerHTML = `
        <div class="fade-in" style="width: 100%; max-width: 700px; background-color: ${config.surface_color}; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.75}px; font-weight: 700; color: ${config.text_color}; margin: 0;">
              Buat Budget Bulanan
            </h2>
            <button id="backBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; padding: 10px 20px; background-color: ${config.secondary_action_color}; color: ${config.surface_color}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
              ${config.back_text}
            </button>
          </div>
          
          <div style="display: grid; gap: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div>
                <label for="bulan" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Bulan</label>
                <input type="number" id="bulan" min="1" max="12" placeholder="1-12" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
              </div>
              <div>
                <label for="tahun" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Tahun</label>
                <input type="number" id="tahun" min="2000" placeholder="2024" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
              </div>
            </div>
            
            <div>
              <label for="pemasukanAwal" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Pemasukan Awal Bulan (Rp)</label>
              <input type="number" id="pemasukanAwal" min="0" placeholder="5000000" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="sumberPemasukan" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Sumber Pemasukan</label>
              <input type="text" id="sumberPemasukan" placeholder="Gaji, Bonus, Freelance, dll" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="targetPengeluaran" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Target Pengeluaran Bulanan (Rp)</label>
              <input type="number" id="targetPengeluaran" min="0" placeholder="3000000" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <button id="saveBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px; background-color: ${config.primary_action_color}; color: ${config.surface_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
              ${config.save_text}
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('backBtn').addEventListener('click', () => renderHome());
      
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 6px 16px rgba(0,0,0,0.25)';
      });
      
      saveBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      });
      
      saveBtn.addEventListener('click', () => {
        const bulan = parseInt(document.getElementById('bulan').value);
        const tahun = parseInt(document.getElementById('tahun').value);
        const pemasukanAwal = parseFloat(document.getElementById('pemasukanAwal').value);
        const sumberPemasukan = document.getElementById('sumberPemasukan').value.trim();
        const targetPengeluaran = parseFloat(document.getElementById('targetPengeluaran').value);
        
        if (!bulan || !tahun || !pemasukanAwal || !sumberPemasukan || !targetPengeluaran) {
          showToast('Mohon isi semua field!');
          return;
        }
        
        if (bulan < 1 || bulan > 12) {
          showToast('Bulan harus antara 1-12!');
          return;
        }
        
        const existingBudget = allRecords.find(r => 
          r.type === 'budget' && r.bulan === bulan && r.tahun === tahun
        );
        
        if (existingBudget) {
          showToast('Budget untuk bulan ini sudah ada!');
          return;
        }
        
        const newBudget = {
          id: Date.now().toString(),
          type: 'budget',
          bulan,
          tahun,
          pemasukan_awal: pemasukanAwal,
          sumber_pemasukan: sumberPemasukan,
          target_pengeluaran: targetPengeluaran,
          created_at: new Date().toISOString()
        };
        
        createRecord(newBudget);
        currentBudget = newBudget;
        showToast('Budget berhasil dibuat!');
        setTimeout(() => renderBudgetDetail(newBudget.id), 1000);
      });
    }

    function renderBudgetList() {
      currentPage = 'budgets';
      const app = document.getElementById('app');
      const budgets = getBudgets();
      
      const months = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      let budgetHTML = '';
      if (budgets.length === 0) {
        budgetHTML = `
          <div style="text-align: center; padding: 60px 20px; color: ${config.secondary_action_color};">
            <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.25}px; font-weight: 600; margin-bottom: 10px;">Belum ada budget</p>
            <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px;">Buat budget bulanan pertama Anda!</p>
          </div>
        `;
      } else {
        budgetHTML = budgets.map(budget => {
          const incomes = getIncomes(budget.id);
          const expenses = getExpenses(budget.id);
          const totalIncome = budget.pemasukan_awal + incomes.reduce((sum, inc) => sum + inc.jumlah_pemasukan, 0);
          const totalExpense = expenses.reduce((sum, exp) => sum + exp.jumlah_pengeluaran, 0);
          const percentage = (totalExpense / budget.target_pengeluaran) * 100;
          const remaining = totalIncome - totalExpense;
          
          return `
            <div class="budget-card" data-budget-id="${budget.id}" style="background-color: ${config.surface_color}; padding: 20px; border-radius: 12px; border-left: 4px solid ${config.primary_action_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                <div>
                  <h3 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.25}px; font-weight: 700; color: ${config.text_color}; margin: 0 0 5px 0;">
                    ${months[budget.bulan]} ${budget.tahun}
                  </h3>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0;">
                    ${expenses.length} pengeluaran tercatat
                  </p>
                </div>
                <div style="text-align: right;">
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0 0 5px 0;">Sisa</p>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.25}px; font-weight: 700; color: ${remaining >= 0 ? config.primary_action_color : '#ef4444'}; margin: 0;">
                    Rp ${remaining.toLocaleString('id-ID')}
                  </p>
                </div>
              </div>
              
              <div style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.text_color}; font-weight: 600;">Pengeluaran</span>
                  <span style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.text_color}; font-weight: 600;">${percentage.toFixed(1)}%</span>
                </div>
                <div style="width: 100%; height: 8px; background-color: ${adjustColor(config.text_color, 220)}; border-radius: 4px; overflow: hidden;">
                  <div class="progress-bar" style="height: 100%; width: ${Math.min(percentage, 100)}%; background-color: ${percentage > 100 ? '#ef4444' : percentage > 80 ? '#f59e0b' : config.primary_action_color}; border-radius: 4px;"></div>
                </div>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color};">
                <div>Budget: Rp ${budget.target_pengeluaran.toLocaleString('id-ID')}</div>
                <div style="text-align: right;">Terpakai: Rp ${totalExpense.toLocaleString('id-ID')}</div>
              </div>
            </div>
          `;
        }).join('');
      }
      
      app.innerHTML = `
        <div class="fade-in" style="width: 100%; max-width: 900px; background-color: ${adjustColor(config.text_color, 245)}; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.75}px; font-weight: 700; color: ${config.text_color}; margin: 0;">
              Daftar Budget
            </h2>
            <button id="backBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; padding: 10px 20px; background-color: ${config.secondary_action_color}; color: ${config.surface_color}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
              ${config.back_text}
            </button>
          </div>
          
          <div style="display: grid; gap: 15px; max-height: 70%; overflow-y: auto;">
            ${budgetHTML}
          </div>
        </div>
      `;
      
      document.getElementById('backBtn').addEventListener('click', () => renderHome());
      
      document.querySelectorAll('.budget-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateX(5px)';
          this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateX(0)';
          this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        });
        
        card.addEventListener('click', function() {
          const budgetId = this.dataset.budgetId;
          renderBudgetDetail(budgetId);
        });
      });
    }

    function renderBudgetDetail(budgetId) {
      currentPage = 'budget-detail';
      const app = document.getElementById('app');
      
      const budget = allRecords.find(r => r.id === budgetId);
      if (!budget) {
        renderBudgetList();
        return;
      }
      
      currentBudget = budget;
      const incomes = getIncomes(budgetId);
      const expenses = getExpenses(budgetId);
      
      const totalIncome = budget.pemasukan_awal + incomes.reduce((sum, inc) => sum + inc.jumlah_pemasukan, 0);
      const totalExpense = expenses.reduce((sum, exp) => sum + exp.jumlah_pengeluaran, 0);
      const saldoAkhir = totalIncome - totalExpense;
      const remaining = totalIncome - totalExpense;
      const percentage = (totalExpense / budget.target_pengeluaran) * 100;
      
      const months = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      let summaryHTML = `
        <div style="background-color: ${adjustColor(config.primary_action_color, 240)}; padding: 25px; border-radius: 12px; margin-bottom: 20px; border: 2px solid ${config.primary_action_color};">
          <h3 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.5}px; font-weight: 700; color: ${config.text_color}; margin: 0 0 20px 0; text-align: center;">
            üìä Rangkuman Cashflow
          </h3>
          
          <div style="background-color: ${config.surface_color}; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
            <h4 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: #10b981; margin: 0 0 15px 0; border-bottom: 2px solid #10b981; padding-bottom: 8px;">
              üí∞ Pemasukan
            </h4>
            <div style="margin-bottom: 10px; padding: 10px; background-color: ${adjustColor(config.text_color, 245)}; border-radius: 6px;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.secondary_action_color}; margin: 0 0 3px 0;">Pemasukan Awal</p>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0; font-style: italic;">${budget.sumber_pemasukan}</p>
                </div>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: #10b981; margin: 0;">
                  Rp ${budget.pemasukan_awal.toLocaleString('id-ID')}
                </p>
              </div>
            </div>
            ${incomes.map(inc => `
              <div style="margin-bottom: 10px; padding: 10px; background-color: ${adjustColor(config.text_color, 245)}; border-radius: 6px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; margin: 0 0 3px 0; font-weight: 600;">${inc.sumber}</p>
                    <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0;">${inc.tanggal} ${months[budget.bulan]} ${budget.tahun}</p>
                  </div>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: #10b981; margin: 0;">
                    Rp ${inc.jumlah_pemasukan.toLocaleString('id-ID')}
                  </p>
                </div>
              </div>
            `).join('')}
            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #10b981; display: flex; justify-content: space-between; align-items: center;">
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: ${config.text_color}; margin: 0;">Total Pemasukan</p>
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.5}px; font-weight: 700; color: #10b981; margin: 0;">
                Rp ${totalIncome.toLocaleString('id-ID')}
              </p>
            </div>
          </div>
          
          <div style="background-color: ${config.surface_color}; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
            <h4 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: #ef4444; margin: 0 0 15px 0; border-bottom: 2px solid #ef4444; padding-bottom: 8px;">
              üí∏ Pengeluaran
            </h4>
            ${expenses.length === 0 ? `
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.secondary_action_color}; margin: 0; text-align: center; padding: 20px;">Belum ada pengeluaran</p>
            ` : expenses.map(exp => `
              <div style="margin-bottom: 10px; padding: 10px; background-color: ${adjustColor(config.text_color, 245)}; border-radius: 6px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; margin: 0 0 3px 0; font-weight: 600;">${exp.kegunaan}</p>
                    <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0;">${exp.tanggal} ${months[budget.bulan]} ${budget.tahun}</p>
                  </div>
                  <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: #ef4444; margin: 0;">
                    Rp ${exp.jumlah_pengeluaran.toLocaleString('id-ID')}
                  </p>
                </div>
              </div>
            `).join('')}
            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #ef4444; display: flex; justify-content: space-between; align-items: center;">
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: ${config.text_color}; margin: 0;">Total Pengeluaran</p>
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.5}px; font-weight: 700; color: #ef4444; margin: 0;">
                Rp ${totalExpense.toLocaleString('id-ID')}
              </p>
            </div>
          </div>
          
          <div style="background: linear-gradient(135deg, ${config.primary_action_color} 0%, ${adjustColor(config.primary_action_color, -20)} 100%); padding: 20px; border-radius: 10px; text-align: center;">
            <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.surface_color}; margin: 0 0 8px 0; opacity: 0.9;">Saldo Akhir</p>
            <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 2}px; font-weight: 700; color: ${config.surface_color}; margin: 0;">
              Rp ${saldoAkhir.toLocaleString('id-ID')}
            </p>
            <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.surface_color}; margin: 8px 0 0 0; opacity: 0.85;">
              ${saldoAkhir >= 0 ? '‚úÖ Cashflow Positif' : '‚ö†Ô∏è Cashflow Negatif'}
            </p>
          </div>
        </div>
      `;
      
      app.innerHTML = `
        <div class="fade-in" style="width: 100%; max-width: 900px; background-color: ${adjustColor(config.text_color, 245)}; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.75}px; font-weight: 700; color: ${config.text_color}; margin: 0;">
              ${months[budget.bulan]} ${budget.tahun}
            </h2>
            <button id="backBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; padding: 10px 20px; background-color: ${config.secondary_action_color}; color: ${config.surface_color}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
              ${config.back_text}
            </button>
          </div>
          
          <div style="background-color: ${config.surface_color}; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
              <div>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0 0 5px 0;">Pemasukan</p>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: ${config.text_color}; margin: 0;">
                  Rp ${budget.pemasukan_awal.toLocaleString('id-ID')}
                </p>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.7}px; color: ${config.secondary_action_color}; margin: 5px 0 0 0; font-style: italic;">
                  dari ${budget.sumber_pemasukan}
                </p>
              </div>
              <div>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0 0 5px 0;">Target Budget</p>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: ${config.text_color}; margin: 0;">
                  Rp ${budget.target_pengeluaran.toLocaleString('id-ID')}
                </p>
              </div>
              <div>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0 0 5px 0;">Sisa Uang</p>
                <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.125}px; font-weight: 700; color: ${remaining >= 0 ? config.primary_action_color : '#ef4444'}; margin: 0;">
                  Rp ${remaining.toLocaleString('id-ID')}
                </p>
              </div>
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600;">Progress Pengeluaran</span>
                <span style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600;">${percentage.toFixed(1)}%</span>
              </div>
              <div style="width: 100%; height: 12px; background-color: ${adjustColor(config.text_color, 220)}; border-radius: 6px; overflow: hidden; margin-bottom: 8px;">
                <div class="progress-bar" style="height: 100%; width: ${Math.min(percentage, 100)}%; background-color: ${percentage > 100 ? '#ef4444' : percentage > 80 ? '#f59e0b' : config.primary_action_color}; border-radius: 6px;"></div>
              </div>
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.75}px; color: ${config.secondary_action_color}; margin: 0;">
                Rp ${totalExpense.toLocaleString('id-ID')} dari Rp ${budget.target_pengeluaran.toLocaleString('id-ID')}
              </p>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <button id="addIncomeBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px; background-color: #10b981; color: ${config.surface_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
              + ${config.add_income_text}
            </button>
            <button id="addExpenseBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px; background-color: ${config.primary_action_color}; color: ${config.surface_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
              + ${config.add_expense_text}
            </button>
          </div>
          
          ${summaryHTML}
        </div>
      `;
      
      document.getElementById('backBtn').addEventListener('click', () => renderBudgetList());
      
      const addIncomeBtn = document.getElementById('addIncomeBtn');
      const addExpenseBtn = document.getElementById('addExpenseBtn');
      
      [addIncomeBtn, addExpenseBtn].forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
          this.style.boxShadow = '0 6px 16px rgba(0,0,0,0.25)';
        });
        
        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        });
      });
      
      addIncomeBtn.addEventListener('click', () => renderAddIncome(budgetId));
      addExpenseBtn.addEventListener('click', () => renderAddExpense(budgetId));
    }

    function renderAddIncome(budgetId) {
      currentPage = 'add-income';
      const app = document.getElementById('app');
      
      const budget = allRecords.find(r => r.id === budgetId);
      if (!budget) {
        renderBudgetList();
        return;
      }
      
      const months = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      app.innerHTML = `
        <div class="fade-in" style="width: 100%; max-width: 700px; background-color: ${config.surface_color}; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
              <h2 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.75}px; font-weight: 700; color: ${config.text_color}; margin: 0 0 5px 0;">
                Tambah Pemasukan
              </h2>
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.secondary_action_color}; margin: 0;">
                ${months[budget.bulan]} ${budget.tahun}
              </p>
            </div>
            <button id="backBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; padding: 10px 20px; background-color: ${config.secondary_action_color}; color: ${config.surface_color}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
              ${config.back_text}
            </button>
          </div>
          
          <div style="display: grid; gap: 20px;">
            <div>
              <label for="tanggal" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Tanggal</label>
              <input type="number" id="tanggal" min="1" max="31" placeholder="1-31" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="jumlah" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Jumlah Pemasukan (Rp)</label>
              <input type="number" id="jumlah" min="0" placeholder="500000" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="sumber" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Sumber Pemasukan</label>
              <input type="text" id="sumber" placeholder="Gaji, Bonus, Freelance, dll" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <button id="saveBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px; background-color: #10b981; color: ${config.surface_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
              ${config.save_text}
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('backBtn').addEventListener('click', () => renderBudgetDetail(budgetId));
      
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 6px 16px rgba(0,0,0,0.25)';
      });
      
      saveBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      });
      
      saveBtn.addEventListener('click', () => {
        const tanggal = parseInt(document.getElementById('tanggal').value);
        const jumlah = parseFloat(document.getElementById('jumlah').value);
        const sumber = document.getElementById('sumber').value.trim();
        
        if (!tanggal || !jumlah || !sumber) {
          showToast('Mohon isi semua field!');
          return;
        }
        
        if (tanggal < 1 || tanggal > 31) {
          showToast('Tanggal harus antara 1-31!');
          return;
        }
        
        const newIncome = {
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
          type: 'income',
          budget_id: budgetId,
          tanggal,
          jumlah_pemasukan: jumlah,
          sumber,
          created_at: new Date().toISOString()
        };
        
        createRecord(newIncome);
        showToast('Pemasukan berhasil dicatat!');
        setTimeout(() => renderBudgetDetail(budgetId), 1000);
      });
    }

    function renderAddExpense(budgetId) {
      currentPage = 'add-expense';
      const app = document.getElementById('app');
      
      const budget = allRecords.find(r => r.id === budgetId);
      if (!budget) {
        renderBudgetList();
        return;
      }
      
      const months = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      app.innerHTML = `
        <div class="fade-in" style="width: 100%; max-width: 700px; background-color: ${config.surface_color}; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
              <h2 style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 1.75}px; font-weight: 700; color: ${config.text_color}; margin: 0 0 5px 0;">
                Tambah Pengeluaran
              </h2>
              <p style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.secondary_action_color}; margin: 0;">
                ${months[budget.bulan]} ${budget.tahun}
              </p>
            </div>
            <button id="backBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; padding: 10px 20px; background-color: ${config.secondary_action_color}; color: ${config.surface_color}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
              ${config.back_text}
            </button>
          </div>
          
          <div style="display: grid; gap: 20px;">
            <div>
              <label for="tanggal" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Tanggal</label>
              <input type="number" id="tanggal" min="1" max="31" placeholder="1-31" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="jumlah" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Jumlah Pengeluaran (Rp)</label>
              <input type="number" id="jumlah" min="0" placeholder="50000" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <div>
              <label for="kegunaan" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size * 0.875}px; color: ${config.text_color}; font-weight: 600; display: block; margin-bottom: 8px;">Untuk Apa?</label>
              <input type="text" id="kegunaan" placeholder="Makan, Transport, Belanja, dll" class="input-field" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; width: 100%; padding: 12px; border: 2px solid ${adjustColor(config.text_color, 180)}; border-radius: 8px; outline: none; color: ${config.text_color};">
            </div>
            
            <button id="saveBtn" style="font-family: '${config.font_family}', sans-serif; font-size: ${config.font_size}px; padding: 16px; background-color: ${config.primary_action_color}; color: ${config.surface_color}; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
              ${config.save_text}
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('backBtn').addEventListener('click', () => renderBudgetDetail(budgetId));
      
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 6px 16px rgba(0,0,0,0.25)';
      });
      
      saveBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      });
      
      saveBtn.addEventListener('click', () => {
        const tanggal = parseInt(document.getElementById('tanggal').value);
        const jumlah = parseFloat(document.getElementById('jumlah').value);
        const kegunaan = document.getElementById('kegunaan').value.trim();
        
        if (!tanggal || !jumlah || !kegunaan) {
          showToast('Mohon isi semua field!');
          return;
        }
        
        if (tanggal < 1 || tanggal > 31) {
          showToast('Tanggal harus antara 1-31!');
          return;
        }
        
        const newExpense = {
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
          type: 'expense',
          budget_id: budgetId,
          tanggal,
          jumlah_pengeluaran: jumlah,
          kegunaan,
          created_at: new Date().toISOString()
        };
        
        createRecord(newExpense);
        showToast('Pengeluaran berhasil dicatat!');
        setTimeout(() => renderBudgetDetail(budgetId), 1000);
      });
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: ${config.text_color};
        color: ${config.surface_color};
        padding: 16px 24px;
        border-radius: 8px;
        font-family: '${config.font_family}', sans-serif;
        font-size: ${config.font_size}px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function adjustColor(color, amount) {
      const num = parseInt(color.replace('#', ''), 16);
      const r = Math.max(0, Math.min(255, (num >> 16) + amount));
      const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
      const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
      return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
    }

    // Initialize app
    loadData();
    renderHome();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a7b75751059e9d3',t:'MTc2NDY4NTE2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
